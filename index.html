<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Voice Form - ุณุช ุชุณุฌููุงุช</title>
<style>
body { font-family: Arial; direction: rtl; max-width:600px; margin:20px auto; background:#f5f5f5; padding:20px; border-radius:10px; }
h2 { text-align:center; }
.question { background:#fff; padding:15px; margin-bottom:15px; border-radius:8px; box-shadow:0 1px 5px rgba(0,0,0,0.1); }
button { margin:5px 5px 5px 0; padding:8px 12px; border:none; border-radius:5px; cursor:pointer; }
button.start { background:#4caf50; color:white; }
button.stop { background:#f44336; color:white; }
button.submit { background:#2196f3; color:white; width:100%; margin-top:10px; }
audio { display:block; margin-top:5px; }
</style>
</head>
<body>

<h2>ูููุฐุฌ ุชุณุฌูู ุณุช ุฃุตูุงุช ูุฎุชููุฉ</h2>
<input id="name" placeholder="ุงูุงุณู" style="width:100%; padding:8px; margin-bottom:15px;"><br>

<div class="question" id="q0">
  <p>1. ุณุฌู ุตูุช ุนุงูู</p>
  <button class="start" onclick="startRecording(0)">๐๏ธ ุจุฏุก</button>
  <button class="stop" onclick="stopRecording(0)">โน๏ธ ุฅููุงู</button>
  <audio id="audio0" controls></audio>
</div>
<div class="question" id="q1">
  <p>2. ุณุฌู ุตูุช ูุงุทู</p>
  <button class="start" onclick="startRecording(1)">๐๏ธ ุจุฏุก</button>
  <button class="stop" onclick="stopRecording(1)">โน๏ธ ุฅููุงู</button>
  <audio id="audio1" controls></audio>
</div>
<div class="question" id="q2">
  <p>3. ุณุฌู ุตูุช ุบุงุถุจ</p>
  <button class="start" onclick="startRecording(2)">๐๏ธ ุจุฏุก</button>
  <button class="stop" onclick="stopRecording(2)">โน๏ธ ุฅููุงู</button>
  <audio id="audio2" controls></audio>
</div>
<div class="question" id="q3">
  <p>4. ุณุฌู ุตูุช ุณุนูุฏ</p>
  <button class="start" onclick="startRecording(3)">๐๏ธ ุจุฏุก</button>
  <button class="stop" onclick="stopRecording(3)">โน๏ธ ุฅููุงู</button>
  <audio id="audio3" controls></audio>
</div>
<div class="question" id="q4">
  <p>5. ุณุฌู ุตูุช ุณุฑูุน ุชููู "ูุง ุฑููู"</p>
  <button class="start" onclick="startRecording(4)">๐๏ธ ุจุฏุก</button>
  <button class="stop" onclick="stopRecording(4)">โน๏ธ ุฅููุงู</button>
  <audio id="audio4" controls></audio>
</div>
<div class="question" id="q5">
  <p>6. ุณุฌู ุตูุช ุจุทุฆ ุชููู "ูุง ุฑููู"</p>
  <button class="start" onclick="startRecording(5)">๐๏ธ ุจุฏุก</button>
  <button class="stop" onclick="stopRecording(5)">โน๏ธ ุฅููุงู</button>
  <audio id="audio5" controls></audio>
</div>

<button class="submit" onclick="sendAll()">๐ค ุฅุฑุณุงู ุฌููุน ุงูุชุณุฌููุงุช</button>
<p id="status"></p>

<script>
let recorder, currentStream;
let chunks=[[],[],[],[],[],[]];

async function startRecording(i){
  try{
    if(currentStream) currentStream.getTracks().forEach(t=>t.stop());
    const stream = await navigator.mediaDevices.getUserMedia({audio:true});
    currentStream=stream;
    recorder=new MediaRecorder(stream);
    chunks[i]=[];
    recorder.ondataavailable=e=>chunks[i].push(e.data);
    recorder.start();
    document.getElementById("status").innerText=`๐ค ุฌุงุฑู ุงูุชุณุฌูู ููุณุคุงู ${i+1}...`;
  }catch(err){alert("โ ุฎุทุฃ ุจุงููููุฑูููู: "+err.message);}
}

function stopRecording(i){
  if(!recorder) return;
  recorder.onstop=()=>{
    const blob=new Blob(chunks[i],{type:"audio/webm"});
    document.getElementById(`audio${i}`).src=URL.createObjectURL(blob);
    document.getElementById("status").innerText=`โ ุชู ุงูุชุณุฌูู ููุณุคุงู ${i+1}`;
  };
  recorder.stop();
  if(currentStream) currentStream.getTracks().forEach(t=>t.stop());
}

function sendAll(){
  const name=document.getElementById("name").value.trim();
  if(!name){alert("ุฃุฏุฎู ุงูุงุณู"); return;}
  for(let i=0;i<6;i++){if(!chunks[i].length){alert(`ุงูุณุคุงู ${i+1} ูู ูุชู ุชุณุฌููู`); return;}}
  document.getElementById("status").innerText="๐ค ุฌุงุฑู ุงูุฅุฑุณุงู...";
  
  for(let i=0;i<6;i++){
    const blob=new Blob(chunks[i],{type:"audio/webm"});
    const formData=new FormData();
    formData.append("name",name);
    formData.append("question",i+1);
    formData.append("audioFile",blob,`record_${i+1}.webm`);

    fetch("https://script.google.com/macros/s/AKfycbzUokg-X2Zm7Dbn0mbqlxqBmdB-d-r_XUX5urXvcftXDui3pMhX7Odxp_kQcBpcdz26/exec",{method:"POST",body:formData})
    .then(r=>r.text()).then(resp=>{
      if(i===5){alert("โ ุชู ุฅุฑุณุงู ูู ุงูุชุณุฌููุงุช"); document.getElementById("status").innerText=""; chunks=[[],[],[],[],[],[]]; for(let j=0;j<6;j++)document.getElementById(`audio${j}`).src="";}
    }).catch(err=>{console.error(err); alert("ุฎุทุฃ ุฃุซูุงุก ุงูุฅุฑุณุงู")});
  }
}
</script>
</body>
</html>

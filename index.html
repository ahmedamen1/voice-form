<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Voice Form - Ø³Øª ØªØ³Ø¬ÙŠÙ„Ø§Øª</title>
<style>
body {
  font-family: Arial, sans-serif;
  direction: rtl;
  max-width: 600px;
  margin: 20px auto;
  background: #f5f5f5;
  padding: 20px;
  border-radius: 10px;
}
h2 { text-align: center; }
.question {
  background: #fff;
  padding: 15px;
  margin-bottom: 15px;
  border-radius: 8px;
  box-shadow: 0 1px 5px rgba(0,0,0,0.1);
}
button {
  margin: 5px 5px 5px 0;
  padding: 8px 12px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
button.start { background: #4caf50; color: white; }
button.stop { background: #f44336; color: white; }
button.submit { background: #2196f3; color: white; width: 100%; margin-top: 10px; }
audio { display: block; margin-top: 5px; }
</style>
</head>
<body>

<h2>Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø³Øª Ø£ØµÙˆØ§Øª Ù…Ø®ØªÙ„ÙØ©</h2>

<input id="name" placeholder="Ø§Ù„Ø§Ø³Ù…" style="width:100%; padding:8px; margin-bottom:15px;"><br>

<div class="question" id="q0">
  <p>1. Ø³Ø¬Ù„ ØµÙˆØª Ø¹Ø§Ù„ÙŠ</p>
  <button class="start" onclick="startRecording(0)">ğŸ™ï¸ Ø¨Ø¯Ø¡</button>
  <button class="stop" onclick="stopRecording(0)">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù</button>
  <audio id="audio0" controls></audio>
</div>

<div class="question" id="q1">
  <p>2. Ø³Ø¬Ù„ ØµÙˆØª ÙˆØ§Ø·ÙŠ</p>
  <button class="start" onclick="startRecording(1)">ğŸ™ï¸ Ø¨Ø¯Ø¡</button>
  <button class="stop" onclick="stopRecording(1)">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù</button>
  <audio id="audio1" controls></audio>
</div>

<div class="question" id="q2">
  <p>3. Ø³Ø¬Ù„ ØµÙˆØª ØºØ§Ø¶Ø¨</p>
  <button class="start" onclick="startRecording(2)">ğŸ™ï¸ Ø¨Ø¯Ø¡</button>
  <button class="stop" onclick="stopRecording(2)">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù</button>
  <audio id="audio2" controls></audio>
</div>

<div class="question" id="q3">
  <p>4. Ø³Ø¬Ù„ ØµÙˆØª Ø³Ø¹ÙŠØ¯</p>
  <button class="start" onclick="startRecording(3)">ğŸ™ï¸ Ø¨Ø¯Ø¡</button>
  <button class="stop" onclick="stopRecording(3)">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù</button>
  <audio id="audio3" controls></audio>
</div>

<div class="question" id="q4">
  <p>5. Ø³Ø¬Ù„ ØµÙˆØª Ø³Ø±ÙŠØ¹ "</p>
  <button class="start" onclick="startRecording(4)">ğŸ™ï¸ Ø¨Ø¯Ø¡</button>
  <button class="stop" onclick="stopRecording(4)">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù</button>
  <audio id="audio4" controls></audio>
</div>

<div class="question" id="q5">
  <p>6. Ø³Ø¬Ù„ ØµÙˆØª Ø¨Ø·Ø¦ ØªÙ‚ÙˆÙ„ "ÙŠØ§ Ø±ÙÙŠÙ‚"</p>
  <button class="start" onclick="startRecording(5)">ğŸ™ï¸ Ø¨Ø¯Ø¡</button>
  <button class="stop" onclick="stopRecording(5)">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù</button>
  <audio id="audio5" controls></audio>
</div>

<button class="submit" onclick="sendAll()">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª</button>

<p id="status"></p>

<script>
let recorder;
let chunks = [[],[],[],[],[],[]];
let currentStream;

async function startRecording(index) {
  try {
    if (currentStream) currentStream.getTracks().forEach(track => track.stop());
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    currentStream = stream;
    recorder = new MediaRecorder(stream);
    chunks[index] = [];
    recorder.ondataavailable = e => chunks[index].push(e.data);
    recorder.start();
    document.getElementById("status").innerText = `ğŸ¤ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù„Ù„Ø³Ø¤Ø§Ù„ ${index+1}...`;
  } catch (err) {
    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†: " + err.message);
    console.error(err);
  }
}

function stopRecording(index) {
  if (!recorder) return;
  recorder.onstop = () => {
    const audioBlob = new Blob(chunks[index], { type: "audio/webm" });
    const audioUrl = URL.createObjectURL(audioBlob);
    document.getElementById(`audio${index}`).src = audioUrl;
    document.getElementById("status").innerText = `âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù„Ù„Ø³Ø¤Ø§Ù„ ${index+1}`;
  };
  recorder.stop();
  if (currentStream) currentStream.getTracks().forEach(track => track.stop());
}

function sendAll() {
  const name = document.getElementById("name").value.trim();
  if (!name) { alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…"); return; }

  for (let i = 0; i < 6; i++) {
    if (!chunks[i].length) { alert(`Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„ ${i+1} Ø¨Ø¹Ø¯`); return; }
  }

  document.getElementById("status").innerText = "ğŸ“¤ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª...";

  for (let i = 0; i < 6; i++) {
    const blob = new Blob(chunks[i], { type: "audio/webm" });
    const reader = new FileReader();
    reader.onloadend = () => {
      fetch("https://script.google.com/macros/s/AKfycbwaCk8xHbKF8-3h7A2uChhTY3LeyTwd68YFyzWWPCoAwFMzCKcwnJr8egYSBf6Cmb6A/exec", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `name=${encodeURIComponent(name)}&audio=${encodeURIComponent(reader.result.split(",")[1])}&question=${i+1}`
      }).then(() => {
        if (i === 5) {
          alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
          document.getElementById("status").innerText = "";
          chunks = [[],[],[],[],[],[]];
          for (let j = 0; j < 6; j++) document.getElementById(`audio${j}`).src = "";
        }
      }).catch(err => {
        console.error(err);
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„");
      });
    };
    reader.readAsDataURL(blob);
  }
}
</script>

</body>
</html>
